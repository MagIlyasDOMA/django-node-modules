import glob
from typing import Optional
from django.template import Library
from .. import BASE_DIR
from ..utils import change_dir

register = Library()


@register.inclusion_tag('django_node_modules/includes/js.html')
def local_node_package(package_name: str, path: Optional[str] = None, recursive: bool = False, module: bool = False):
    package_path = BASE_DIR / 'node_modules' / package_name
    if path is None:
        with change_dir(package_path):
            files = glob.glob('*.js', recursive=recursive)
    else:
        files = [package_path / path]
    return dict(files=files, module=module)
