import filetype, os
from contextlib import contextmanager
from django.conf import settings

BASE_DIR = settings.BASE_DIR


@contextmanager
def change_dir(destination):
    """Контекстный менеджер для временной смены директории"""
    original_dir = os.getcwd()
    try:
        os.chdir(destination)
        yield
    finally:
        os.chdir(original_dir)


def local_node_file_path(path):
    return BASE_DIR / 'node_modules' / path


def local_node_file(path, **kwargs):
    return open(local_node_file_path(path), **kwargs)


def get_mime_type(path):
    kind = filetype.guess(path)
    if kind is None:
        return 'application/octet-stream'
    return kind.mime
